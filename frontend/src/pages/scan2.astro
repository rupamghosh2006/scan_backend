---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
---
<Layout>
  <Navbar />

  <main class="p-6 bg-cyan-50 min-h-screen text-gray-800">
    <h1 class="text-2xl font-bold mb-4">Submit a Question</h1>

    <div class="space-y-4 max-w-2xl">
      <textarea id="textOutput" rows="4" placeholder="Write the question here..." class="w-full p-2 border rounded"></textarea>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input id="optA" class="p-2 border rounded" placeholder="Option A" />
        <input id="optB" class="p-2 border rounded" placeholder="Option B" />
        <input id="optC" class="p-2 border rounded" placeholder="Option C" />
        <input id="optD" class="p-2 border rounded" placeholder="Option D" />
      </div>

      <div class="flex gap-2">
        <label><input type="radio" name="answerKey" value="A" /> A</label>
        <label><input type="radio" name="answerKey" value="B" /> B</label>
        <label><input type="radio" name="answerKey" value="C" /> C</label>
        <label><input type="radio" name="answerKey" value="D" /> D</label>
      </div>

      <select id="classSelect" class="p-2 border rounded">
        <option disabled selected>Select Class</option>
        <option value="11">Class 11</option>
        <option value="12">Class 12</option>
      </select>

      <select id="subjectSelect" class="p-2 border rounded">
        <option disabled selected>Select Subject</option>
        <option value="Physics">Physics</option>
        <option value="Chemistry">Chemistry</option>
        <option value="Math">Math</option>
        <option value="Biology">Biology</option>
      </select>

      <input id="chapterInput" class="p-2 border rounded w-full" placeholder="Enter Chapter Name" />

      <button onclick="saveQuestion()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Save Question</button>
    </div>

    <script is:inline>
      function getAnswerKey() {
        const selected = document.querySelector("input[name='answerKey']:checked");
        if (!selected) return null;
        const optionId = "opt" + selected.value;
        const input = document.getElementById(optionId);
        return input ? input.value.trim() : null;
      }

      function saveQuestion() {
        const data = {
          question: document.getElementById("textOutput").value.trim(),
          options: [
            document.getElementById("optA").value.trim(),
            document.getElementById("optB").value.trim(),
            document.getElementById("optC").value.trim(),
            document.getElementById("optD").value.trim()
          ],
          correctAnswer: getAnswerKey(),
          class: document.getElementById("classSelect").value,
          subject: document.getElementById("subjectSelect").value,
          chapter: document.getElementById("chapterInput").value.trim()
        };

        console.log("Sending question:", data);

        fetch("http://localhost:4000/api/v1/scan/addQuestion", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(res => {
          alert("✅ Question submitted!");
          console.log("Response:", res);
        })
        .catch(err => {
          console.error("❌ Failed:", err);
          alert("Something went wrong!");
        });
      }
    </script>
  </main>
</Layout>
